{
	"transformation-sets": {
		"raw-transform": {
			"db": {
				"src.db": "scrum-api",
				"dest.db": "jira-export"
			},
			"transformations": {
				"sprint-assignments": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.assignments",
						"dest.collection": "sprint.assignments_raw",
						"transformation": {
							"transform_values": {
								"assignment2json": "row.update({'json': json.dumps(row)})",
								"assignment2label": "row.update({'label': '{}_{}'.format(row['group'], row['date'])})"
							}
						},
						"fields": ["key", "label", "json"]						
					}
				},
				"sprint-all-items": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.idx_all_items",
						"dest.collection": "sprint.idx_all_items"
					}
				}				
			}
		},
		"integration-transform": {
			"db": {
				"src.db": "jira-export",
				"dest.db": "jira-export"
			},
			"transformations": {
				"sprint-assignment-search-transpose": {
					"type": "transpose_to_array",
					"cfg": {
						"src.collection": "sprint.assignments_raw",
						"dest.collection": "sprint.assignments_search_labels",
						"transformation": {
								"key": "key",
								"values": "label"
						}						
					}
				},
				"sprint-assignment-json-transpose": {
					"type": "transpose_to_array",
					"cfg": {
						"src.collection": "sprint.assignments_raw",
						"dest.collection": "sprint.assignments_json",
						"transformation": {
								"key": "key",
								"values": "json"
						}
					}
				},
				"sprint-assignment-label-join": {
					"type": "left_join",
					"cfg": {
						"src.collection": "sprint.idx_all_items",
						"dest.collection": "sprint.assignments_search_labels",
						"transformation": {
								"left": "sprint.assignments_search_labels",
								"join_on": "key"
						},
						"fields": ["key", "label"]
					}
				},
				"sprint-assignment-json-join": {
					"type": "left_join",
					"cfg": {
						"src.collection": "sprint.idx_all_items",
						"dest.collection": "sprint.assignments_json",
						"transformation": {
								"left": "sprint.assignments_json",
								"join_on": "key"
						},
						"fields": ["key", "json"]
					}
				},
				"sprint-assignment-label-notnull": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.assignments_search_labels",
						"dest.collection": "sprint.assignments_search_labels",
						"transformation": {
							"transform_values": {
								"label_notnull": "row.update({'label': [] if not row['label'] else row['label']})"
							}
						}
					}
				},
				"sprint-assignment-json-notnull": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.assignments_json",
						"dest.collection": "sprint.assignments_json",
						"transformation": {
							"transform_values": {
								"json_notnull": "row.update({'json': [] if not row['json'] else row['json']})"
							}
						}
					}
				}				
			}
		}
	}
}
