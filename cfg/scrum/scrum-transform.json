{
	"version": 0.1,
	"transformation-sets": {
		"src-transform": {
			"db": {
				"src.db": "jira-import",
				"dest.db": "scrum-transform"
			},
			"transformations": {
				"sprint-timeline": {
					"type": "single_object",
					"cfg": {
						"src.collection": "sprint",
						"dest.collection": "sprint.timeline",
						"transformation": {
							"timeline": "obj['timeline'] = pd.date_range(obj['startDate'], obj['endDate']).strftime('%Y-%m-%d').tolist()"
						},
						"fields": ["timeline"]
					}
				},
				"sprint-definition": {
					"type": "single_object",
					"cfg": {
						"src.collection": "sprint",
						"dest.collection": "sprint.definition"					
					}
				},
				"sprint-all_items": {
					"type": "dataset",
					"cfg": {
						"src.collection": "backlog",
						"dest.collection": "sprint.all_items",
						"transformation": {
							"transform_values": {
								"sec2hrs": "dataset['estimate'] = dataset['estimate']/3600"
							}
						}						
					}
				}
			}
		},
		"int-transform": {
			"db": {
				"src.db": "scrum-transform",
				"dest.db": "scrum-transform"
			},
			"transformations": {
				"blocked_by": {
					"type": "transpose_array",
					"cfg": {
						"src.collection": "sprint.all_items",
						"dest.collection": "sprint.idx_blocked_by",
						"transformation": {
							"key": "key",
							"values": "blocked_by"
						}
					}
				}			
			}
		},
		"dest-transform": {
			"db": {
				"src.db": "scrum-transform",
				"dest.db": "scrum-api"
			},
			"transformations": {
				"sprint.definition": {
					"type": "single_object",
					"cfg": {
						"src.collection": "sprint.definition",
						"dest.collection": "sprint.definition"						
					}
				},
				"sprint.timeline": {
					"type": "single_object",
					"cfg": {
						"src.collection": "sprint.timeline",
						"dest.collection": "sprint.timeline"						
					}
				},
				"backlog": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.all_items",
						"dest.collection": "sprint.backlog",
						"transformation": {
							"where": "type == 'Story' or type == 'Bug'",
							"order": {
								"by_column": "priority",
								"sort_order": ["Highest", "High", "Medium", "Low", "Lowest"]
							}
						},
						"fields": ["key", "type", "priority"]
					}
				},
				"backlog-details": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.all_items",
						"dest.collection": "sprint.backlog-details",
						"transformation": {
							"where": "type == 'Story' or type == 'Bug'"
						},	
						"fields": ["key", "type", "priority", "status", "assignee_id", "duedate", "estimate", "components", "blocked_by"]
					}
				},
				"subtasks": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.all_items",
						"dest.collection": "sprint.subtasks",
						"transformation": {
							"where": "type == 'Sub-task'",
							"order": {
								"by_column": "priority",
								"sort_order": ["Highest", "High", "Medium", "Low", "Lowest"]
							}
						},
						"fields": ["key", "parent", "type", "priority", "status"]
					}				
				},
				"subtasks-details": {
					"type": "dataset",
					"cfg": {
						"src.collection": "sprint.all_items",
						"dest.collection": "sprint.subtasks-details",
						"transformation": {
							"where": "type == 'Sub-task'"
						},	
						"fields": ["key", "type", "priority", "status", "assignee_id", "duedate", "estimate", "components", "blocked_by"]
					}
				}				
			}
		}
	}
}
