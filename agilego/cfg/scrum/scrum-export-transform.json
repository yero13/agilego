{
	"transformation-sets": {
		"raw-transform": {
			"db": {
				"src.db": "$db_scrum_api",
				"dest.db": "$db_jira_export"
			},
			"transformations": {
				"sprint-assignments": {
					"class": "ext.transformations.DatasetTransformation",
					"cfg": {
						"src.collection": "sprint.assignments",
						"dest.collection": "sprint.assignments_raw",
						"transformation": {
							"transform_values": {
								"assignment2tech": "row.update({'tech': '{}_{}_{}_{}_{}_{}_{}'.format(row['key'], row['parent'] if row['parent'] else '', row['date'].strftime('%Y-%m-%d'), row['group'], row['employee'], row['whrs'], row['comment'] if row['comment'] else '')})",
								"assignment2label": "row.update({'label': '{}_{}'.format(row['group'], row['date'].strftime('%Y-%m-%d'))})"
							}
						},
						"fields": ["key", "label", "tech"]						
					}
				},
				"sprint-all-items": {
					"class": "ext.transformations.DatasetTransformation",
					"cfg": {
						"src.collection": "sprint.idx_all_items",
						"dest.collection": "sprint.idx_all_items"
					}
				}				
			}
		},
		"integration-transform": {
			"db": {
				"src.db": "$db_jira_export",
				"dest.db": "$db_jira_export"
			},
			"transformations": {
				"sprint-assignment-search-transpose": {
					"class": "ext.transformations.TransposeToArrayTransformation",
					"cfg": {
						"src.collection": "sprint.assignments_raw",
						"dest.collection": "sprint.assignments_search_labels",
						"transformation": {
								"key": "key",
								"values": "label"
						}						
					}
				},
				"sprint-assignment-tech-transpose": {
					"class": "ext.transformations.TransposeToArrayTransformation",
					"cfg": {
						"src.collection": "sprint.assignments_raw",
						"dest.collection": "sprint.assignments_tech",
						"transformation": {
								"key": "key",
								"values": "tech"
						}
					}
				},
				"sprint-assignment-label-join": {
					"class": "ext.transformations.LeftJoinTransformation",
					"cfg": {
						"src.collection": "sprint.idx_all_items",
						"dest.collection": "sprint.assignments_search_labels",
						"transformation": {
								"left": "sprint.assignments_search_labels",
								"join_on": "key"
						},
						"fields": ["key", "label"]
					}
				},
				"sprint-assignment-tech-join": {
					"class": "ext.transformations.LeftJoinTransformation",
					"cfg": {
						"src.collection": "sprint.idx_all_items",
						"dest.collection": "sprint.assignments_tech",
						"transformation": {
								"left": "sprint.assignments_tech",
								"join_on": "key"
						},
						"fields": ["key", "tech"]
					}
				},
				"sprint-assignment-label-notnull": {
					"class": "ext.transformations.DatasetTransformation",
					"cfg": {
						"src.collection": "sprint.assignments_search_labels",
						"dest.collection": "sprint.assignments_search_labels",
						"transformation": {
							"transform_values": {
								"label_notnull": "row.update({'label': [] if not row['label'] else row['label']})"
							}
						}
					}
				},
				"sprint-assignment-tech-notnull": {
					"class": "ext.transformations.DatasetTransformation",
					"cfg": {
						"src.collection": "sprint.assignments_tech",
						"dest.collection": "sprint.assignments_tech",
						"transformation": {
							"transform_values": {
								"tech_notnull": "row.update({'tech': [] if not row['tech'] else row['tech']})"
							}
						}
					}
				}				
			}
		}
	}
}
