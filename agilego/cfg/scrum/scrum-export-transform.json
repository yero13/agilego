{
	"transformation-sets": {
		"copy": {
			"db": {
				"src.db": "db_scrum_api",
				"dest.db": "db_jira_export"
			},
			"transformations": {
				"assignements": {
					"class": "transformation.transformer.Col2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": "sprint.assignments"
						},
						"transform": {
							"func": "transformation.transformer.copy"
						},
						"dest.db.cleanup": {
							"target": "sprint.assignments"
						},
						"dest.db.save": {
							"dest": "sprint.assignments"
						}
					}
				},
				"sprint-all-items": {
					"class": "transformation.transformer.Col2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": "sprint.backlog"
						},
						"transform": {
							"func": "transformation.transformer.copy",
							"params": {
								"fields": ["key"]
							}
						},
						"dest.db.cleanup": {
							"target": "sprint.idx_all_items"
						},
						"dest.db.save": {
							"dest": "sprint.idx_all_items"
						}
					}
				}				
			}
		},
		"transform": {
			"db": {
				"src.db": "db_jira_export",
				"dest.db": "db_jira_export"
			},
			"transformations": {
				"assignments-tech": {
					"class": "transformation.transformer.Col2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": "sprint.assignments"
						},
						"transform": {
							"func": "transformation.transformer.format",
							"params": {
								"format.string": "{}_{}_{:%Y-%m-%d}_{}_{}_{:n}_{}",
								"format.input": [
									{
										"field": "key",
										"type": "string"
									},
									{
										"field": "parent",
										"type": "string"
									},
									{
										"field": "date",
										"type": "date"
									},
									{
										"field": "group",
										"type": "string"
									},									
									{
										"field": "employee",
										"type": "string"
									},						
									{
										"field": "whrs",
										"type": "float"
									},					
									{
										"field": "comment",
										"type": "string"
									}									
								],
								"result.field": "tech" 
							}								
						},
						"dest.db.cleanup": {
							"target": "sprint.assignments_tech"
						},
						"dest.db.save": {
							"dest": "sprint.assignments_tech"
						}
					}
				},
				"assignments-label": {
					"class": "transformation.transformer.Col2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": "sprint.assignments_tech"
						},
						"transform": {
							"func": "transformation.transformer.format",
							"params": {
								"format.string": "{}_{:%Y-%m-%d}",
								"format.input": [
									{
										"field": "group",
										"type": "string"
									},									
									{
										"field": "date",
										"type": "date"
									}									
								],
								"result.field": "label" 
							}								
						},
						"dest.db.cleanup": {
							"target": "sprint.assignments_raw"
						},
						"dest.db.save": {
							"dest": "sprint.assignments_raw"
						}
					}
				},				
				"sprint-assignment-search-transpose": {
					"class": "transformation.transformer.Col2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": "sprint.assignments_raw"
						},
						"transform": {
							"func": "transformation.transformer.group_singles2array",
							"params": {
								"field.key": "key",
								"field.array": "label",
								"field.single": "label"								
							}						
						},
						"dest.db.cleanup": {
							"target": "sprint.assignments_search_labels"
						},
						"dest.db.save": {
							"dest": "sprint.assignments_search_labels"
						}						
					}
				},
				"sprint-assignment-tech-transpose": {
					"class": "transformation.transformer.Col2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": "sprint.assignments_raw"
						},
						"transform": {
							"func": "transformation.transformer.group_singles2array",
							"params": {
								"field.key": "key",
								"field.array": "tech",
								"field.single": "tech"								
							}						
						},
						"dest.db.cleanup": {
							"target": "sprint.assignments_tech"
						},
						"dest.db.save": {
							"dest": "sprint.assignments_tech"
						}						
					}
				},
				"sprint-assignment-label-join": {
					"class": "transformation.transformer.MultiCol2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": ["sprint.idx_all_items", "sprint.assignments_search_labels"]
						},
						"transform": {
							"func": "transformation.transformer.left_join",
							"params": {
								"col.right": "sprint.idx_all_items",
								"col.left": "sprint.assignments_search_labels",
								"field.join": "key"								
							}						
						},
						"dest.db.cleanup": {
							"target": "sprint.assignments_label"
						},
						"dest.db.save": {
							"dest": "sprint.assignments_label"
						}						
					}
				},
				"sprint-assignment-tech-join": {
					"class": "transformation.transformer.MultiCol2ColTransformation",
					"cfg": {
						"src.db.load": {
							"src": ["sprint.idx_all_items", "sprint.assignments_tech"]
						},
						"transform": {
							"func": "transformation.transformer.left_join",
							"params": {
								"col.right": "sprint.idx_all_items",
								"col.left": "sprint.assignments_tech",
								"field.join": "key"								
							}						
						},
						"dest.db.cleanup": {
							"target": "sprint.assignments_tech"
						},
						"dest.db.save": {
							"dest": "sprint.assignments_tech"
						}						
					}
				}				
			}
		},
		"integration-transform": {
			"db": {
				"src.db": "$db_jira_export",
				"dest.db": "$db_jira_export"
			},
			"transformations": {
				"sprint-assignment-label-notnull": {
					"class": "ext.transformations.DatasetTransformation",
					"cfg": {
						"src.collection": "sprint.assignments_search_labels",
						"dest.collection": "sprint.assignments_search_labels",
						"transformation": {
							"transform_values": {
								"label_notnull": "row.update({'label': [] if not row['label'] else row['label']})"
							}
						}
					}
				},
				"sprint-assignment-tech-notnull": {
					"class": "ext.transformations.DatasetTransformation",
					"cfg": {
						"src.collection": "sprint.assignments_tech",
						"dest.collection": "sprint.assignments_tech",
						"transformation": {
							"transform_values": {
								"tech_notnull": "row.update({'tech': [] if not row['tech'] else row['tech']})"
							}
						}
					}
				}				
			}
		}
	}
}
